# Keyword Configuration for Pre-filtering Channels
# Edit this file to add/remove keywords without changing code

keywords:
  - baby
  - babies
  - toddler
  - toddlers
  - lullaby
  - child
  - peppa pig
  - bluey
  - disney
  - talking tom
  - baby shark
  - cartoon
  - toon
  - nursery
  - rhyme
  - kid
  - kids
  - children
  - toddler
  - preschool

# Additional Configuration
processing:
  # Batch size for processing channels
  batch_size: 100

  # Maximum concurrent workers
  max_workers: 5

  # Delay between API calls (seconds) to respect rate limits
  rate_limit_delay: 0.1

  # Maximum retries for failed API calls
  max_retries: 3

# OpenAI Categorization Prompt Template
openai:
  system_prompt: |
    You are an expert YouTube channel analyst specializing in advertising targeting and brand safety.
    Analyze channels for: children's content (COPPA compliance), content category, brand safety, and purchase intent.
    Use ONLY the provided metadata. Do not invent information. Be precise and objective.

  user_prompt_template: |
    Analyze this YouTube channel for advertising purposes:

    Channel Name: {channel_name}
    Channel Description: {description}
    Keywords: {keywords}
    Country: {country}
    Subscribers: {subscriber_count}
    Total Videos: {video_count}
    Total Views: {view_count}
    Channel Created: {published_at}

    Recent Videos (last 5):
    {recent_videos}

    Provide comprehensive analysis as JSON:
    {{
      "compliance": {{
        "is_children_content": true/false,
        "confidence": "high"/"medium"/"low",
        "reasoning": "Brief explanation for children's content determination"
      }},
      "content": {{
        "primary_vertical": "Gaming|Beauty|Tech|Finance|Education|Entertainment|Health|Lifestyle|News|Sports|Music|Other",
        "sub_niche": "specific niche description (e.g., 'Budget Tech Reviews', 'Makeup Tutorials')",
        "format": "Tutorial|Review|Vlog|Commentary|Entertainment|Educational|News|Gaming",
        "confidence": "high|medium|low"
      }},
      "brand_safety": {{
        "overall_score": "safe|moderate|risky",
        "controversial_topics": true/false,
        "premium_suitable": true/false,
        "flags": ["list specific concerns if any, empty array if none"]
      }},
      "targeting": {{
        "geographic_focus": "local|regional|global",
        "primary_language": "en|es|fr|hi|ja|de|pt|other",
        "purchase_intent": "high|medium|low"
      }},
      "summary": "2-3 sentence summary of key findings for ad targeting"
    }}

    Example 1 - Children's content (EXCLUDE from campaigns):
    {{
      "compliance": {{"is_children_content": true, "confidence": "high", "reasoning": "Channel features nursery rhymes and animations clearly targeting toddlers"}},
      "content": {{"primary_vertical": "Entertainment", "sub_niche": "Children's Educational Content", "format": "Educational", "confidence": "high"}},
      "brand_safety": {{"overall_score": "risky", "controversial_topics": false, "premium_suitable": false, "flags": ["COPPA compliance required - children's content"]}},
      "targeting": {{"geographic_focus": "global", "primary_language": "en", "purchase_intent": "low"}},
      "summary": "Children's content targeting preschoolers. EXCLUDE from ad campaigns to avoid COPPA violations and wasted spend on non-converting audiences."
    }}

    Example 2 - Safe tech content (INCLUDE in campaigns):
    {{
      "compliance": {{"is_children_content": false, "confidence": "high", "reasoning": "Tech reviews for adult enthusiasts with advanced technical language"}},
      "content": {{"primary_vertical": "Tech", "sub_niche": "Consumer Electronics Reviews", "format": "Review", "confidence": "high"}},
      "brand_safety": {{"overall_score": "safe", "controversial_topics": false, "premium_suitable": true, "flags": []}},
      "targeting": {{"geographic_focus": "global", "primary_language": "en", "purchase_intent": "high"}},
      "summary": "Tech review channel with high purchase intent. Safe for premium advertisers. Target for electronics, gadgets, and tech service campaigns."
    }}

# Email Configuration
email:
  subject: "DV360 Children's Channel Analysis Results - {date}"
  body_template: |
    <html>
    <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
      <h2 style="color: #2c3e50;">DV360 YouTube Channel Analysis Complete</h2>

      <p>Hello,</p>

      <p>The automated analysis of YouTube channels from the DV360 placement report has completed successfully.</p>

      {partial_warning}

      <h3 style="color: #e74c3c;">Summary Statistics</h3>
      <ul>
        <li><strong>Total channels analyzed:</strong> {total_channels}</li>
        <li><strong>Flagged as children's content:</strong> {flagged_count} channels</li>
        <li><strong>Safe channels (not children's content):</strong> {safe_count} channels</li>
        <li><strong>Cache hits (previously analyzed):</strong> {cache_hits}</li>
        <li><strong>New analyses this run:</strong> {api_calls}</li>
        <li><strong>Processing time:</strong> {processing_time}</li>
      </ul>

      <h3 style="color: #27ae60;">Download CSV Files</h3>
      <p>The analysis results are available as <strong>two CSV files</strong> stored in Cloud Storage. Click the links below to download (links expire in 7 days):</p>

      <div style="background-color: #efe; padding: 15px; border-left: 4px solid #27ae60; margin: 15px 0;">
        <h4 style="margin-top: 0; color: #27ae60;">1. Inclusion List (SAFE Channels)</h4>
        <p><strong>File:</strong> <code>inclusion_list_safe_channels_{date}.csv</code></p>
        <p>Contains <strong>{safe_count} channels</strong> that are <strong>NOT</strong> children's content and are safe for advertising.</p>
        <p><em>These channels passed the analysis and do not target children.</em></p>
        <p style="margin-top: 15px;">
          <a href="{inclusion_url}" style="display: inline-block; padding: 10px 20px; background-color: #27ae60; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
            Download Inclusion List
          </a>
        </p>
      </div>

      <div style="background-color: #fee; padding: 15px; border-left: 4px solid #e74c3c; margin: 15px 0;">
        <h4 style="margin-top: 0; color: #e74c3c;">2. Exclusion List (BLOCK These Channels)</h4>
        <p><strong>File:</strong> <code>exclusion_list_children_channels_{date}.csv</code></p>
        <p>Contains <strong>{flagged_count} channels</strong> identified as children's content that should be <strong>BLOCKED</strong> from DV360 campaigns.</p>
        <p><em>Use this list to exclude these channels from your ad placements.</em></p>
        <p style="margin-top: 15px;">
          <a href="{exclusion_url}" style="display: inline-block; padding: 10px 20px; background-color: #e74c3c; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
            Download Exclusion List
          </a>
        </p>
      </div>

      <h3 style="color: #3498db;">Caching & Cost Savings</h3>
      <p>All channels have been cached in Firestore. Future runs will be significantly faster and cheaper:</p>
      <ul>
        <li>Cached channels: <strong>{cache_hits}</strong> (reused from previous analysis)</li>
        <li>New analyses: <strong>{api_calls}</strong> (incurred API costs)</li>
        <li>Expected cache hit rate in next run: <strong>~90%</strong></li>
      </ul>

      <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">

      <p style="color: #7f8c8d; font-size: 12px;">
        <em>This is an automated email from the DV360 YouTube Channel Analyzer.<br>
        Powered by Google Cloud Functions, YouTube Data API, and OpenAI GPT-4o-mini.</em>
      </p>
    </body>
    </html>
